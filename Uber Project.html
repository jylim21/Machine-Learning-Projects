<!DOCTYPE HTML>
<!--
	Massively by HTML5 UP
	html5up.net | @ajlkn
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
	<head>
		<title>Generic Page - Massively by HTML5 UP</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" href="assets/css/main.css" />
		<noscript><link rel="stylesheet" href="assets/css/noscript.css" /></noscript>

		
	</head>
	<body class="is-preload">

		<!-- Wrapper -->
			<div id="wrapper">

				<!-- Header -->
					<header id="header">
						<a href="index.html" class="logo">Massively</a>
					</header>

				<!-- Nav -->
					<nav id="nav">
						<ul class="links">
							<li><a href="index.html">About Me</a></li>
							<li class="active"><a href="generic.html">Projects</a></li>
							<li><a href="elements.html">Contact Me</a></li>
						</ul>
						<ul class="icons">
							<li><a href="https://www.linkedin.com/in/juenyuh-lim/" target="_blank" class="icon brands fa-linkedin"><span class="label">Linkedin</span></a></li>
							<li><a href="https://github.com/jylim21/Projects" target="_blank" class="icon brands fa-github"><span class="label">GitHub</span></a></li>
						</ul>
					</nav>

				<!-- Main -->
					<div id="main">

						<!-- Post -->
							<section class="post">
								<header class="major">
									<span class="date">April 25, 2017</span>
									<h1>Data Visualization: Uber Fare Analysis</h1>
								</header>
								<div class="image main"><img src="images/uber.jpg" alt="" /></div>
								<p>In 2023, Uber has a reported active drivers reaching 1.5 million in the United States alone, occupying up to 74% of the global e-hailing market.</p>
								<p>A core part of Uber's business is dynamic pricing - also known as surge pricing - where fares fluctuate based on supply and demand principles. When demand for rides is high, such as during rush hour or special events when the demand for rides are high, fares increase automatically to entice more drivers to get on the road.</p>
								<p>As Uber has grown exponentially in recent years to become the dominant e-hailing service globally, analysis on its pricing model and decisions has become increasingly important. This webpage will take a data-driven look at how Uber's fares are set across different situations. The goal is to provide transparency and insight into a key aspect of a company that has disrupted transportation enormously in a short span of time.</p>
								<h2>The Project</h2>
								<p>This analysis will be conducted using Python, with the following libraries: </p>
								<ul>
									<li><b>Pandas</b> - A staple for reading and manipulating structured data.</li>
									<li><b>Numpy</b> - For array-based operations.</li>
									<li><b>Matplotlib</b> and <b>Seaborn</b> - Used together to produce stunning visuals.</li>
									<li><b>Datetime</b> - Used to parse datetimes into their respective components such as days, hours, and minutes.</li>
									<li><b>Folium</b> - An interactive map to visualize pickup and dropoff locations with provided coordinates</li>
									<li><b>Nominatim</b> by <b>Geopy</b> - Used to calculate the <i>Haversine</i> distance between 2 coordinates</li>
								</ul>
								<p>And we will be using the <a href="https://www.kaggle.com/datasets/yasserh/uber-fares-dataset" target="_blank">Uber Fares Dataset by M YASSER H</a> which can be found on Kaggle, it contains data of 500k trips which are mainly concentrated in the suburbs of New York City, a pretty big one I would say!</p>
							<p>To begin, let's import all the relevant libraries to our kernel.</p>
							
							<button class="collapsible">Click to expand Python code block</button>
							<div class="content">
							<pre>
								<div class="highlight">
									<code>

										import pandas as pd
										import numpy as np
										import matplotlib.pyplot as plt
										import seaborn as sns
										from datetime import datetime, timedelta
										import folium
										from folium.plugins import MarkerCluster, MousePosition
										from folium.features import DivIcon
										from geopy.geocoders import Nominatim
										df = pd.read_csv("/kaggle/input/uber-fares-dataset/uber.csv")
									</code>
								</div>
								</pre>
							</div>
							
							<p>It's a good idea to have an overview on the dataset, checking for data quality issues to ensure the validity of our findings. Let's check what features are available here:</p>
							<div class="highlight">
								<pre>
									<code>

										print(df.shape[0])
										print(df.dtypes)
									</code>
								</pre>
								</div>

							<p>Also checking if there are any empty data in it. I have defined a function which shows the number and % of NaN and data containg zeros in it, and can be replicated across other projects:</p>
							<div class="highlight">
								<pre>
									<code>

									def summary(dtf):
									sumary=pd.concat([dtf.isna().sum(),((dtf == 0.sum())/dtf.shape[0],dtf.dtypes], axis=1)
    								sumary=sumary.rename(columns={sumary.columns[0]: 'NaN'})
    								sumary=sumary.rename(columns={sumary.columns[1]: 'Zeros'})
    								sumary=sumary.rename(columns={sumary.columns[2]: 'Type'})
    								sumary['NaN']=sumary['NaN'].astype(str)+' ('+((sumary['NaN']*100/dtf.shape[0]).astype(int)).astype(str)+'%)'
    								sumary['Zeros']=(sumary['Zeros']*100).astype(int)
    								sumary['Zeros']=(dtf == 0).sum().astype(str)+' ('+sumary['Zeros'].astype(str)+'%)'
    								sumary=sumary[['Type','NaN','Zeros']]
    								return

									print(summary(df))
									</code>
								</pre>
								</div>
								<h3>Output</h3>
								<img class="image-left" src="images/uber/1.jpg" alt=""/>
								<p>Looks like we have at least 3k entries having nil latitudes and longitudes which does not seem to be valid here. Though it is generally not advisable to drop empty rows, this case is an exception as the empty entries only make up 1% of the dataset.</p>
								<p>We will do the same approach for zero values in fare_amount and the NaNs in dropoff_longitude and dropoff_latitude.</p>
							<div class="highlight">
								<pre>
									<code>
										df=df[df['pickup_longitude']!=0]
										df=df[df['pickup_latitude']!=0 | df['dropoff_longitude']!=0 | df['dropoff_latitude']!=0 | df['passenger_count']!=0]
										df.reset_index(inplace=True)
										df.drop(['index','key'], axis=1, inplace=True)
										df.rename(columns={"Unnamed: 0": "trip"}, inplace=True)

										print(summary(df))
									</code>
								</pre>
								</div>

								<h3>Mapping of pickup and dropoff locations</h3>
								<p>I'm pretty sure everyone is curious on the locations served by this Uber driver on the net, we can easily map the pickup and dropoff coordinates using the Folium library imported earlier.</p>
								<div class="highlight">
									<pre>
										<code>
											
											mymap = folium.Map(location=[40.6970193,-74.3093268], zoom_start=4)
											marker_cluster = MarkerCluster(name='Pickups')
											marker_cluster2 = MarkerCluster(name='Dropoffs')
											marker_cluster.add_to(mymap)
											marker_cluster2.add_to(mymap)
											for index, row in df1.sample(n=5000, random_state=123).iterrows():
												lb1, lb2 = row['trip'], row['fare_amount']
												folium.Marker(location=[row['pickup_latitude'], row['pickup_longitude']], icon=folium.Icon(color='blue'), popup=row['trip']).add_to(marker_cluster)
												folium.Marker(location=[row['dropoff_latitude'], row['dropoff_longitude']], icon=folium.Icon(color='red'), popup=row['trip']).add_to(marker_cluster2)
												folium.LayerControl(collapsed=False).add_to(mymap)
												
											formatter = "function(num) {return L.Util.formatNum(num, 5);};"
											mouse_position = MousePosition(
												position='topright',
												separator=' Long: ',
												empty_string='NaN',
												lng_first=False,
												num_digits=20,
												prefix='Lat:',
												lat_formatter=formatter,
												lng_formatter=formatter,
												)
												
											mymap.add_child(mouse_position)
											display(mymap)</span>
										</code>
									</pre>
									</div>
								<p>Well, it seems that this driver serves New York City most of his time, unfortunately this map also exposes many other problematic coordinates provided to us. Notice that there are coordinates in the sea, few minor ones in Europe, below the straits of Ghana, and even in Antartica!</p>					
								<p>We are not done with our data cleansing yet, the zero entries were just the tip of an iceberg and we have to perform further checks on the coordinates:</p>
									
								<h4>1. Invalid Coordinates</h4>
								<p>latitudes and longitudes can only take on the following range of values, any value which falls outside these ranges are 100% invalid:</p>
								<ul>
									<li>Latitudes: -90 to 90</li>
									<li>Longitudes: -180 to 180</li>
								</ul>
								<div class="highlight">
									<pre>
										<code>
										df[(abs(df['pickup_latitude'])>90)|(abs(df['dropoff_latitude'])>90)|(abs(df['dropoff_longitude'])>180)|(abs(df['pickup_longitude'])>180)].head(10)
										</code>
									</pre>
									</div>
								<h4>2. Swapped Latitude and Longitude Values</h4>
								<p>Some rides had their latitude and longitude pairs reversed by plotting the coordinates, showing impossible pickup/dropoff locations.</p>
								<div class="highlight">
									<pre>
										<code>
										df[(df['pickup_latitude']<-70) | (df['dropoff_latitude']<-70)].head()
										</code>
									</pre>
									</div>
								<h4>3. Intercontinential Travel</h4>
								<p>There are also trips which spans across continents (big difference in pickup & dropoff longitudes), and it all takes less than $30, what a bang for a buck!</p>
								<div class="highlight">
									<pre>
										<code>
											df=df[abs(df['pickup_longitude']-df['dropoff_longitude'])<40]
										</code>
									</pre>
									</div>
								<h4>4. Trips in the Ocean</h4>
								<p>Some rides had their latitude and longitude pairs reversed by plotting the coordinates, this is where the Antartica coordinates came from.</p>
								<div class="highlight">
									<pre>
										<code>
										df=df[abs(df['pickup_longitude'])>1]
										df=df[~(((df['pickup_latitude']<40.52) & (df['pickup_longitude']>-73.96)) | ((df['dropoff_latitude']<40.52) & (df['dropoff_longitude']>-73.96)))]
										</code>
									</pre>
									</div>
								<h4>5. Identical Dropoff and Pickup Locations</h4>
								<p>Seriously, why am I paying if your car didn't even budge? And surprisingly there were 1,316 of such trips!</p>
								<div class="highlight">
									<pre>
										<code>
											df=df[(df['pickup_longitude']!= df['dropoff_longitude']) | (df['pickup_latitude']!= df['dropoff_latitude'])]
										</code>
									</pre>
									</div>
								<p>With all the invalid entries removed, our map should be concentrated on a specific inland region, let's see if we are good:</p>
								<div class="highlight">
									<pre>
										<code>
											display(mymap)
										</code>
									</pre>
									</div>
								<h2>Fare Amount Evolution by Date and Time</h2>
								<p>We are also provided with data on the pickup datetime, which can be split into their respective years, months, weekdays, and hours etc. to visualize the following:</p>
								<ul>
									<li>Yearly comparison to find out if there is an annual price adjustment due to inflation.</li>
									<li>Day of week comparison to investigate if rates are higher on weekdays or weekends.</li>
									<li>Hourly comparison to find out their 'peak' hours, which allows us to validate the 'surge pricing' model mentioned earlier.</li>
								</ul>
								<p>However, if you look closely at the pickup times, they are based off the UTC timezone which is 4 to 5 hours earlier than New York which follows Eastern Time, the UTC times can be converted to Eastern time using the datetime library imported earlier,</p>
								<div class="highlight">
									<pre>
										<code>
											df.reset_index(inplace=True)
											df.drop(['index'], axis=1, inplace=True)
											df['pickup_datetime']=pd.to_datetime(df['pickup_datetime'])
											df['pickup_datetime']=df['pickup_datetime'].dt.tz_convert('America/New_York')
											
											df['pickup_datetime'].head()
										</code>
									</pre>
									</div>
								<p>Now to proceed with parsing them:</p>
								<p>The newly produced Hour column will take values ranging from 0-23, with 0 being 12am. As for WeekDay, the range would be 0-6 with 0 being a Monday.</p>
								<div class="highlight">
									<pre>
										<code>
											df['Year'] = df['pickup_datetime'].dt.year
											df['WeekDay'] = df['pickup_datetime'].dt.weekday
											df['Hour'] = df['pickup_datetime'].dt.hour
											df.head()
										</code>
									</pre>
								</div>

								<h2>EDA</h2>
								<h3>Univariate Analysis</h3>
								<p>Notice that we haven't touched on the numerical features in our analysis, let's visualize the fare_amount and passenger_count to detect any abnormalities.</p>
								<div class="highlight">
									<pre>
										<code>
											fig, axs = plt.subplots(1, 2, figsize=(10, 5))
											sns.boxplot(data=df['fare_amount'],orient='h', ax=axs[0]).set(title='fare_amount')
											sns.boxplot(data=df['passenger_count'], orient='h', ax=axs[1]).set(title='passenger_count')
											plt.show()
										</code>
									</pre>
								</div>
								<p>The presence of an extreme outlier in both (fare_amount reaching $500 and passenger_count above 200) has made it difficult to visualize the quartiles, we should remove it as it occurred only once in this massive dataset but has a potential impact on our model building later.</p>
								<p>Also, notice that there are fare_amount below 0 which shouldn't be the case here? They will be dropped too.</p>
								<div class="highlight">
									<pre>
										<code>
											df=df[(df['fare_amount']<400) & (df['fare_amount']>0)]
											df=df[df['passenger_count']<150]
											fig, axs = plt.subplots(1, 2, figsize=(10, 5))
											sns.boxplot(data=df1['fare_amount'],orient='h', ax=axs[0]).set(title='fare_amount')
											sns.boxplot(data=df1['passenger_count'], orient='h', ax=axs[1]).set(title='passenger_count')
											plt.show()
										</code>
									</pre>
								</div>
								<p>Now we are able to observe the distributions with clarity. </p>
								<p>Obviously the passenger_count is positively skewed with most of the trips carrying only 1 passenger. further transformations are still required but we will do it after the EDA section.</p>
							</section>
					</div>

						
				<!-- Footer -->
					<footer id="footer">
						<section>
							<form method="post" action="#">
								<div class="fields">
									<div class="field">
										<label for="name">Name</label>
										<input type="text" name="name" id="name" />
									</div>
									<div class="field">
										<label for="email">Email</label>
										<input type="text" name="email" id="email" />
									</div>
									<div class="field">
										<label for="message">Message</label>
										<textarea name="message" id="message" rows="3"></textarea>
									</div>
								</div>
								<ul class="actions">
									<li><input type="submit" value="Send Message" /></li>
								</ul>
							</form>
						</section>
						<section class="split contact">
							<section class="alt">
								<h3>Address</h3>
								<p>1234 Somewhere Road #87257<br />
								Nashville, TN 00000-0000</p>
							</section>
							<section>
								<h3>Phone</h3>
								<p><a href="#">(000) 000-0000</a></p>
							</section>
							<section>
								<h3>Email</h3>
								<p><a href="#">info@untitled.tld</a></p>
							</section>
							<section>
								<h3>Social</h3>
								<ul class="icons alt">
									<li><a href="#" class="icon brands alt fa-twitter"><span class="label">Twitter</span></a></li>
									<li><a href="#" class="icon brands alt fa-facebook-f"><span class="label">Facebook</span></a></li>
									<li><a href="#" class="icon brands alt fa-instagram"><span class="label">Instagram</span></a></li>
									<li><a href="#" class="icon brands alt fa-github"><span class="label">GitHub</span></a></li>
								</ul>
							</section>
						</section>
					</footer>

				<!-- Copyright -->
					<div id="copyright">
						<ul><li>&copy; Untitled</li><li>Design: <a href="https://html5up.net">HTML5 UP</a></li></ul>
					</div>

			</div>

		<!-- Scripts -->
			<script src="assets/js/jquery.min.js"></script>
			<script src="assets/js/jquery.scrollex.min.js"></script>
			<script src="assets/js/jquery.scrolly.min.js"></script>
			<script src="assets/js/browser.min.js"></script>
			<script src="assets/js/breakpoints.min.js"></script>
			<script src="assets/js/util.js"></script>
			<script src="assets/js/main.js"></script>
			<script src="assets/js/collapsible.js"></script>

	</body>
</html>